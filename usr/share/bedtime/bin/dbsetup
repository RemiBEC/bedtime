#!/usr/bin/perl

use warnings;
use strict;

my $pass = $ARGV[0];
my $conf = '';

# See if we have an empty password
if (length($pass) < 1) {
   `logger btsetup was called with an empty password`;
} else {
   # Read the conf file into an array
   open (CONF, "/etc/bedtime.conf");
   my @lines = <CONF>;
   close CONF;

   # Look for the dbpass line
   foreach my $line (@lines) {
      if ($line =~ m/dbpass/) {
         # Replace the password
         $conf .= "$`$& = $pass\n";
      } else {
         $conf .= $line;
      }
   }
   # Write it back to the conf file
   open (CONF,">/etc/bedtime.conf");
   print CONF "$conf"; close CONF;
}
